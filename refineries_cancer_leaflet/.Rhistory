CancerRates[missing_state[i],"county"] = gsub("\\s*\\([^\\)]+\\)", "", CancerRates[missing_state[i],"county"])
}
# Remove the (...) from the state values
nh_lymphoma[] <- lapply(nh_lymphoma, function(x) gsub("\\s*\\([^\\)]+\\)", "", x))
CancerRates[] <- lapply(CancerRates, function(x) gsub("\\s*\\([^\\)]+\\)", "", x))
# Remove the space# from the end of some of the values in the rate column of CancerRates
CancerRates[] <- lapply(CancerRates, function(x) gsub("\\#", "", x))
# Convert full state names to abbreviations for a clean df merge later.
nh_lymphoma$state <- state.abb[match(nh_lymphoma$state,state.name)]
CancerRates$state <- state.abb[match(CancerRates$state,state.name)]
# Convert cancer rates to numeric value
nh_lymphoma$rate <- as.numeric(as.character(nh_lymphoma$rate))
CancerRates$rate <- as.numeric(as.character(CancerRates$rate))
# Merge spatial df with downloaded data (using merge function from sp library)
nh_lymphoma_map <- merge(us.map, nh_lymphoma, by=c("GEOID"))
cancermap <- merge(us.map, CancerRates, by=c("GEOID"))
### CREATE POP-UPS ###
# Make popup for non-hodgkin lymphoma
popup_nh_lymphoma <- paste0("<strong>County: </strong>",
nh_lymphoma_map$county,
"<br><strong>State: </strong>",
nh_lymphoma_map$state,
"<br><strong>Non-Hodgkin Lymphoma Rate (Age Adjusted)
<br>    Out of 100,000: </strong>",
nh_lymphoma_map$rate)
# Make popup for overall cancer rate
popup_cancer <- paste0("<strong>County: </strong>",
cancermap$county,
"<br><strong>State: </strong>",
cancermap$state,
"<br><strong>Cancer Rate (Age Adjusted)
<br>    Out of 100,000: </strong>",
cancermap$rate)
# Make popup for coal power plants
popup_coal <- paste0("<i><strong>Coal Power Plant</strong></i>",
"<br><strong>City, State: </strong>",
coal_power_plants$city, ", ", coal_power_plants$state,
"<br><strong>Facility Name: </strong>",
coal_power_plants$name,
"<br><strong>Utility Name: </strong>",
coal_power_plants$utility_name,
"<br><strong>Power Generation: </strong>",
coal_power_plants$mw, " MW")
# Make popup for petroleum refineries
popup_refineries <- paste0("<i><strong>Petroleum Refinery</strong></i>",
"<br><strong>Location: </strong>",
refineries_df$site, ", ", refineries_df$state,
"<br><strong>Owner: </strong>",
refineries_df$corp)
# Set color palette
pal <- colorQuantile("YlOrRd", NULL, n = 9)
# Set icons
coalplant_icons <- awesomeIcons(
icon = 'industry',
iconColor = 'black',
library = 'fa',
markerColor = "lightgray"
)
refinery_icons <- awesomeIcons(
icon = 'tint',
iconColor = 'black',
library = 'fa'
)
# Create map
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -105, lat = 40, zoom = 4) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addAwesomeMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=refinery_icons, group = "Petroleum Refineries") %>%
addAwesomeMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -105, lat = 40, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addAwesomeMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=refinery_icons, group = "Petroleum Refineries") %>%
addAwesomeMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -99, lat = 39, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addAwesomeMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=refinery_icons, group = "Petroleum Refineries") %>%
addAwesomeMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addAwesomeMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=refinery_icons, group = "Petroleum Refineries") %>%
addAwesomeMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
coalplant_icons <- awesomeIcons(
icon = 'industry',
iconColor = 'black',
library = 'fa'#,
#markerColor = "lightgray"
)
refinery_icons <- awesomeIcons(
icon = 'tint',
iconColor = 'black',
library = 'fa'
)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
?icons
coalplant_icons <- icons(
iconURL = "refinery.svg",
iconWidth = 18, iconHeight = 18
)
refinery_icons <- icons(
iconUrl = "refinery.svg",
iconWidth = 18, iconHeight = 18
)
coalplant_icons <- icons(
iconUrl = "refinery.svg",
iconWidth = 18, iconHeight = 18
)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
coalplant_icons <- icons(
iconUrl = "refinery.svg",
iconWidth = 22, iconHeight = 22
)
refinery_icons <- icons(
iconUrl = "refinery.svg",
iconWidth = 22, iconHeight = 22
)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
coalplant_icons <- icons(
iconUrl = "refinery.svg",
iconWidth = 30, iconHeight = 30
)
refinery_icons <- icons(
iconUrl = "refinery.svg",
iconWidth = 30, iconHeight = 30
)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
coalplant_icons <- icons(
iconUrl = "power_plant.svg",
iconWidth = 30, iconHeight = 30
)
refinery_icons <- icons(
iconUrl = "oil_barrel.svg",
iconWidth = 30, iconHeight = 30
)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
?markerOptions
coalplant_icons <- icons(
iconUrl = "power_plant.svg",
iconWidth = 30, iconHeight = 30
)
refinery_icons <- icons(
iconUrl = "oil_barrel.svg",
iconWidth = 30, iconHeight = 30
)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
head(coal_power_plants)
str(coal_power_plants)
power_plants_df$mw <- as.numeric(as.character(power_plants_df$mw))
coal_power_plants <- power_plants_df[power_plants_df$source == "coal" &
!power_plants_df$state %in% c("Hawaii", "Alaska"),]
str(coal_power_plants)
summary(coal_power_plants$mw)
coal_power_plants <- power_plants_df[power_plants_df$source == "coal" &
!power_plants_df$state %in% c("Hawaii", "Alaska") &
power_plants_df$mw >= 1000,]
popup_coal <- paste0("<i><strong>Coal Power Plant</strong></i>",
"<br><strong>City, State: </strong>",
coal_power_plants$city, ", ", coal_power_plants$state,
"<br><strong>Facility Name: </strong>",
coal_power_plants$name,
"<br><strong>Utility Name: </strong>",
coal_power_plants$utility_name,
"<br><strong>Power Generation: </strong>",
coal_power_plants$mw, " MW")
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants"),
options = layersControlOptions(collapsed = FALSE))
gmap
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 5) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants Over 1000 MW") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants Over 1000 MW"),
options = layersControlOptions(collapsed = FALSE))
gmap
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
gmap <- leaflet() %>%
addTiles() %>%
setView(lng = -97, lat = 38.5, zoom = 4) %>%
addPolygons(data = nh_lymphoma_map,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_nh_lymphoma,
group="Lymphoma Rate/100,000 by Counties") %>%
addPolygons(data = cancermap,
fillColor = ~pal(rate),
fillOpacity = 0.8,
color = "#BDBDC3",
weight = 1,
popup = popup_cancer,
group="Cancer Rate/100,000 by Counties") %>%
addMarkers(data=refineries_df,lat=~lat, lng=~lng, popup=popup_refineries,
icon=~refinery_icons, group = "Petroleum Refineries") %>%
addMarkers(data=coal_power_plants,lat=~lat, lng=~lng, popup=popup_coal,
icon=~coalplant_icons, group = "Coal Power Plants Over 1000 MW") %>%
addLayersControl(
baseGroups = c("Lymphoma Rate/100,000 by Counties", "Cancer Rate/100,000 by Counties"),
overlayGroups = c("Petroleum Refineries", "Coal Power Plants Over 1000 MW"),
options = layersControlOptions(collapsed = FALSE))
saveWidget(gmap, 'cancer_powerplant_refinery_map.html', selfcontained = TRUE)
